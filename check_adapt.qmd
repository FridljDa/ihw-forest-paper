---
title: "check_adapt"
format: html
editor: visual
---

```{r}
devtools::load_all(here::here("IHWForestPaper"))
```

## Noise

```{r}
noise_sim_list <- noise_sim(m = 1000, r = 1, dimensions = 1)
noise_sim_list <- lapply(noise_sim_list, function(noise_sim_list_i){
  noise_sim_list_i$alpha <- 0.1
  #noise_sim_list_i$pvalue <- runif(1000)#rep(1, 1000)
  noise_sim_list_i
})
```

```{r, eval = FALSE}
evaluated_simulation <- eval_sim_parallel(noise_sim_list,
                                          methods = c("BH", "AdaPT"),
                                          #methods = c("AdaPT"),
                                          
                                          parallel = FALSE
)
```

```{r, eval = FALSE}
evaluated_simulation %>%
plot_fdr_power(group_by_dimension = "dimension")
```

## flexible

```{r}
dimensions <- seq(from = 1, to = 1, by = 1)
  m <- c(1000)
  r <- 20
  seed = seq_len(r)
  #ndim = dimensions
  signal_strength = 0.8
  lp_norm = 1
  target_average_alt_prob = 0.2#seq(0.1, 0.2, by = 0.01)# # ##
  beta_shape1 = 0.25 
  kappa = 0
  alpha = 0.1
  
sim_parameters <- expand.grid(
  dimensions = dimensions,
  m = m, 
  kappa = kappa,
  alpha = alpha,
  seed = seed,
  signal_strength = signal_strength,
  lp_norm = lp_norm,
  target_average_alt_prob = target_average_alt_prob,
  beta_shape1 = beta_shape1
)  

sim_parameters$ndim <- 1#sim_parameters$dimensions
head(sim_parameters)
```

```{r}
prop_alt_function_creator <- discrete_prop_alt_creator
prop_alt_function_name <- "discrete_prop_alt"
```

```{r}
simulation_list <- flexible_prop_alt_sim(
  sim_parameters = sim_parameters,
  prop_alt_function_creator = prop_alt_function_creator,
  prop_alt_function_name = prop_alt_function_name
)
```

```{r}
evaluated_simulation <- eval_sim_parallel(simulation_list,
                                          
                                          methods = c("BH", "AdaPT")
)
```

```{r}
evaluated_simulation %>%
  plot_fdr_power(group_by_dimension = "dimensions", log_trans = FALSE) 
```
